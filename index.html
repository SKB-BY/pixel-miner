<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Pixel Miner</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: linear-gradient(135deg, #0f0c29, #3a1c71);
      color: white;
      font-family: 'Segoe UI', sans-serif;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding-top: 20px;
      overflow: hidden;
    }
    .container {
      text-align: center;
      width: 95%;
      max-width: 500px;
    }
    h1 {
      font-size: 1.8em;
      margin-bottom: 15px;
      color: #ffcc00;
      text-shadow: 0 0 10px rgba(255,204,0,0.5);
    }
    .stat {
      background: rgba(0,0,0,0.3);
      padding: 8px;
      margin: 6px 0;
      border-radius: 8px;
      font-size: 1.2em;
    }
    .btn {
      padding: 12px;
      margin: 8px 4px;
      border: none;
      border-radius: 10px;
      font-size: 1em;
      font-weight: bold;
      cursor: pointer;
      width: 95%;
      max-width: 280px;
      transition: transform 0.1s;
    }
    .btn:active { transform: scale(0.97); }
    #mineBtn {
      width: 130px;
      height: 130px;
      border-radius: 50%;
      background: radial-gradient(circle, #ff416c, #ff4b2b);
      color: white;
      font-size: 1.3em;
      border: 3px solid #ffcc00;
      box-shadow: 0 6px 20px rgba(255,65,108,0.6);
      margin: 15px 0;
    }
    .donate-btn { background: linear-gradient(135deg, #FFD700, #FFA500); color: #000; }
    .cycle-btn { background: linear-gradient(135deg, #00c9ff, #92fe9d); color: #000; }
    .upgrade-btn { background: linear-gradient(135deg, #8E2DE2, #4A00E0); color: white; }
    .map-btn { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; }
    .build-btn { background: linear-gradient(135deg, #2ecc71, #1abc9c); color: white; }

    #mapView {
      margin-top: 20px;
      min-height: 180px;
      background: rgba(0,0,0,0.25);
      border-radius: 12px;
      padding: 12px;
      display: none;
    }
    .building-label {
      margin-top: 10px;
      font-size: 0.95em;
      color: #aaffaa;
    }
    .building {
      width: 70px;
      height: 140px;
      margin: 10px auto;
      background: #111;
      position: relative;
      border: 2px solid #555;
      overflow: hidden;
    }
    .floor {
      width: 100%;
      height: 14px; /* 140px / 10 = 10 —ç—Ç–∞–∂–µ–π –Ω–∞ —ç–∫—Ä–∞–Ω–µ (–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ) */
      background: #27ae60;
      border-bottom: 1px solid #1e8449;
      animation: appear 0.3s ease;
    }
    @keyframes appear {
      from { opacity: 0; transform: scaleY(0); }
      to { opacity: 1; transform: scaleY(1); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>‚ö° Pixel Miner</h1>
    <div class="stat">–≠–Ω–µ—Ä–≥–∏—è: <b id="energy">0</b></div>
    <div class="stat">–û—Å–∫–æ–ª–∫–æ–≤ –ê—Å–∫–µ–Ω–∑–∏–∏: <b id="shards">0</b></div>
    <div class="stat">–¶–∏–∫–ª–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ: <b id="cycles">0</b></div>
    <button id="mineBtn">–¢–ê–ü!</button>
    <br>
    <button class="btn upgrade-btn" id="upgrade">–£–ª—É—á—à–∏—Ç—å –¥–æ–±—ã—á—É (+1) ‚Äì 10 –≠–Ω.</button>
    <button class="btn cycle-btn" id="cycle">üîÑ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ü–∏–∫–ª –æ—á–∏—â–µ–Ω–∏—è</button>
    <button class="btn donate-btn" id="donate">üíé –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (TON)</button>
    <button class="btn map-btn" id="mapBtn">üó∫Ô∏è –ö–∞—Ä—Ç–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</button>

    <div id="mapView">
      <div>üèóÔ∏è –î–æ–º ‚Ññ<b id="buildingNum">1</b> (<b id="floorCount">0</b>/100 —ç—Ç–∞–∂–µ–π)</div>
      <div class="building" id="buildingVisual"></div>
      <div>–ù–∞–∂–∞—Ç–∏–π: <b id="buildClicks">0</b> / 1000</div>
      <button class="btn build-btn" id="buildBtn">üî® –°—Ç—Ä–æ–∏—Ç—å</button>
      <div class="building-label" id="buildingStatus">–§—É–Ω–¥–∞–º–µ–Ω—Ç –∑–∞–ª–æ–∂–µ–Ω...</div>
    </div>
  </div>

  <script>
    // === Telegram WebApp ===
    const tg = window.Telegram?.WebApp;
    if (tg) {
      tg.expand();
      tg.ready();
    }

    // === –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã ===
    const WALLET_ADDRESS = "UQA5aUC-_Z0IK4_NqFJVdBKCGUzO9DXFwHMs7gwSMWGM8CxY";
    const CLICKS_PER_FLOOR = 1000;
    const MAX_FLOORS = 100;

    // === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö ===
    let game = JSON.parse(localStorage.getItem('pixelMiner_v4')) || {
      energy: 0,
      shards: 0,
      cycles: 0,
      tapPower: 1,
      // –°—Ç—Ä–æ–π–∫–∞
      buildClicks: 0,
      floors: 0,
      buildings: 1,
      userId: tg?.initDataUnsafe?.user?.id || Math.floor(Math.random() * 1e9)
    };

    // === DOM —ç–ª–µ–º–µ–Ω—Ç—ã ===
    const el = {
      energy: document.getElementById('energy'),
      shards: document.getElementById('shards'),
      cycles: document.getElementById('cycles'),
      mineBtn: document.getElementById('mineBtn'),
      upgrade: document.getElementById('upgrade'),
      cycle: document.getElementById('cycle'),
      donate: document.getElementById('donate'),
      mapBtn: document.getElementById('mapBtn'),
      mapView: document.getElementById('mapView'),
      buildBtn: document.getElementById('buildBtn'),
      buildClicks: document.getElementById('buildClicks'),
      buildingNum: document.getElementById('buildingNum'),
      floorCount: document.getElementById('floorCount'),
      buildingVisual: document.getElementById('buildingVisual'),
      buildingStatus: document.getElementById('buildingStatus')
    };

    // === –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI ===
    function render() {
      // –û—Å–Ω–æ–≤–Ω–æ–π —ç–∫—Ä–∞–Ω
      el.energy.textContent = Math.floor(game.energy);
      el.shards.textContent = game.shards;
      el.cycles.textContent = game.cycles;

      // –ö–∞—Ä—Ç–∞
      el.buildingNum.textContent = game.buildings;
      el.floorCount.textContent = game.floors;
      el.buildClicks.textContent = game.buildClicks;

      // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∑–¥–∞–Ω–∏—è (–º–∞–∫—Å. 10 –±–ª–æ–∫–æ–≤ –Ω–∞ —ç–∫—Ä–∞–Ω–µ)
      el.buildingVisual.innerHTML = '';
      const visibleFloors = Math.min(game.floors, 10);
      for (let i = 0; i < visibleFloors; i++) {
        const floor = document.createElement('div');
        floor.className = 'floor';
        el.buildingVisual.appendChild(floor);
      }

      // –°—Ç–∞—Ç—É—Å
      if (game.floors >= MAX_FLOORS) {
        el.buildingStatus.textContent = '‚úÖ –î–æ–º –∑–∞–≤–µ—Ä—à—ë–Ω! –°—Ç—Ä–æ–∏—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–π.';
      } else if (game.floors > 0) {
        el.buildingStatus.textContent = 'üèóÔ∏è –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –∏–¥—ë—Ç!';
      } else {
        el.buildingStatus.textContent = '–§—É–Ω–¥–∞–º–µ–Ω—Ç –∑–∞–ª–æ–∂–µ–Ω...';
      }
    }

    // === –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ===
    function save() {
      localStorage.setItem('pixelMiner_v4', JSON.stringify(game));
      render();
    }

    // === –û—Å–Ω–æ–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è ===
    el.mineBtn.onclick = () => { game.energy += game.tapPower; save(); };
    el.upgrade.onclick = () => { if (game.energy >= 10) { game.energy -= 10; game.tapPower++; save(); } };
    el.cycle.onclick = () => {
      if (game.energy <= 0) return;
      const shards = Math.max(1, Math.floor(game.tapPower * 0.6));
      game.shards += shards;
      game.energy = 0;
      game.cycles++;
      alert(`‚úÖ –¶–∏–∫–ª –∑–∞–≤–µ—Ä—à—ë–Ω!\n+${shards} –æ—Å–∫–æ–ª–∫–æ–≤ –ê—Å–∫–µ–Ω–∑–∏–∏.`);
      save();
    };
    el.donate.onclick = () => {
      const comment = "PixelMiner_Support_" + game.userId;
      const url = `ton://transfer/${WALLET_ADDRESS}?amount=${0.1 * 1e9}&text=${encodeURIComponent(comment)}`;
      if (tg?.openTelegramLink) tg.openTelegramLink(url);
      else window.open(url, '_blank');
    };

    // === –ö–∞—Ä—Ç–∞ ===
    el.mapBtn.onclick = () => {
      el.mapView.style.display = el.mapView.style.display === 'none' ? 'block' : 'none';
    };

    el.buildBtn.onclick = () => {
      if (game.floors >= MAX_FLOORS) {
        // –ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—ã–π –¥–æ–º
        game.buildings++;
        game.floors = 0;
        game.buildClicks = 0;
        alert('–ù–∞—á–∞—Ç–æ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –Ω–æ–≤–æ–≥–æ –∑–¥–∞–Ω–∏—è!');
      } else {
        game.buildClicks++;
        if (game.buildClicks >= CLICKS_PER_FLOOR) {
          game.floors++;
          game.buildClicks = 0;
          if (game.floors === MAX_FLOORS) {
            alert('üèÜ –î–æ–º –∑–∞–≤–µ—Ä—à—ë–Ω! –ù–∞–∂–º–∏—Ç–µ "–°—Ç—Ä–æ–∏—Ç—å", —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –Ω–æ–≤–æ–µ –∑–¥–∞–Ω–∏–µ.');
          }
        }
      }
      save();
    };

    // === –ó–∞–ø—É—Å–∫ ===
    render();
  </script>
</body>
</html>
