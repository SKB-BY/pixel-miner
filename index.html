<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Pixel Miner</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    :root {
      --primary: #ff416c;
      --secondary: #2575fc;
      --accent: #FFD700;
      --dark: #0a0720;
      --light: #ffffff;
      --success: #2ecc71;
      --danger: #e74c3c;
      --building: #1abc9c;
    }

    body {
      background: linear-gradient(135deg, var(--dark), #1a1240);
      color: var(--light);
      font-family: 'Segoe UI', system-ui, sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: clamp(10px, 4vh, 20px) clamp(5px, 3vw, 15px);
      overflow-y: auto;
      text-align: center;
      position: relative;
    }

    .header {
      margin-bottom: clamp(12px, 5vh, 20px);
    }

    .header h1 {
      font-size: clamp(1.6rem, 6vw, 2.2rem);
      background: linear-gradient(90deg, var(--accent), #ff7e5f);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      font-weight: 800;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.2);
      margin-bottom: 8px;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
      gap: clamp(8px, 2.5vw, 12px);
      width: 100%;
      margin-bottom: clamp(15px, 6vh, 25px);
    }

    .stat-card {
      background: rgba(0, 0, 0, 0.35);
      backdrop-filter: blur(4px);
      border-radius: 14px;
      padding: clamp(10px, 3.5vh, 14px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .stat-label {
      font-size: clamp(0.8rem, 2.8vw, 0.95rem);
      opacity: 0.85;
      margin-bottom: 4px;
    }

    .stat-value {
      font-size: clamp(1.2rem, 4.5vw, 1.6rem);
      font-weight: bold;
      color: var(--accent);
    }

    #mineBtn {
      width: clamp(100px, 25vw, 140px);
      height: clamp(100px, 25vw, 140px);
      border-radius: 50%;
      background: radial-gradient(circle, var(--primary), #ff4b2b);
      color: white;
      font-size: clamp(1.1rem, 4vw, 1.4rem);
      font-weight: bold;
      border: 3px solid var(--accent);
      box-shadow:
        0 6px 20px rgba(255, 65, 108, 0.6),
        inset 0 2px 6px rgba(255, 255, 255, 0.2);
      cursor: pointer;
      transition: all 0.15s ease;
      margin: clamp(15px, 5vh, 25px) 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #mineBtn:active {
      transform: scale(0.94);
      box-shadow: 0 3px 10px rgba(255, 65, 108, 0.5);
    }

    .actions {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: clamp(8px, 2.5vw, 12px);
      width: 100%;
      margin-top: clamp(10px, 4vh, 20px);
    }

    .btn {
      padding: clamp(10px, 3.2vh, 14px) clamp(12px, 4vw, 20px);
      border: none;
      border-radius: 12px;
      font-size: clamp(0.9rem, 3.2vw, 1.05rem);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      min-width: 140px;
      max-width: 100%;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
    }

    .btn:active {
      transform: translateY(2px);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }

    .upgrade-btn { background: linear-gradient(135deg, #8E2DE2, #4A00E0); color: white; }
    .cycle-btn { background: linear-gradient(135deg, #00c9ff, #92fe9d); color: #000; }
    .donate-btn { background: linear-gradient(135deg, #FFD700, #FFA500); color: #000; }
    .map-btn { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; }

    #mapView {
      margin-top: clamp(20px, 6vh, 30px);
      background: rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(6px);
      border-radius: 16px;
      padding: clamp(14px, 4.5vh, 20px);
      width: 100%;
      display: none;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .building-container {
      margin: 15px auto;
      width: clamp(100px, 25vw, 150px);
      min-height: clamp(200px, 50vh, 250px);
      background: #0d0a20;
      border: 2px solid #444;
      position: relative;
      overflow: hidden;
      border-radius: 4px;
      display: flex;
      flex-direction: column-reverse;
      justify-content: flex-start;
    }

    .floor {
      width: 100%;
      height: calc(100% / 10);
      background: linear-gradient(to right, var(--building), #16a085);
      border-bottom: 1px solid #0d7a63;
      animation: floorPop 0.3s ease-out;
    }

    @keyframes floorPop {
      0% { transform: scaleY(0); opacity: 0.6; }
      100% { transform: scaleY(1); opacity: 1; }
    }

    .pulse {
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); }
      100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
    }

    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 12px 20px;
      border-radius: 12px;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      display: none;
      animation: fadeInOut 2s forwards;
    }

    @keyframes fadeInOut {
      0% { opacity: 0; transform: translateX(-50%) translateY(20px); }
      10% { opacity: 1; transform: translateX(-50%) translateY(0); }
      90% { opacity: 1; transform: translateX(-50%) translateY(0); }
      100% { opacity: 0; transform: translateX(-50%) translateY(20px); }
    }

    @media (max-height: 600px) {
      body { padding-top: 5px; }
      .actions { gap: 6px; }
      .btn { padding: 8px 12px; font-size: 0.85rem; }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>‚ö° Pixel Miner</h1>
  </div>

  <div class="stats">
    <div class="stat-card">
      <div class="stat-label">–≠–Ω–µ—Ä–≥–∏—è</div>
      <div class="stat-value" id="energy">0</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">–û—Å–∫–æ–ª–∫–æ–≤</div>
      <div class="stat-value" id="shards">0</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">–¶–∏–∫–ª–æ–≤</div>
      <div class="stat-value" id="cycles">0</div>
    </div>
  </div>

  <button id="mineBtn" class="pulse">
    <i class="fas fa-bolt"></i>
  </button>

  <div class="actions">
    <button class="btn upgrade-btn" id="upgrade">
      <i class="fas fa-arrow-up"></i> –£–ª—É—á—à–∏—Ç—å
    </button>
    <button class="btn cycle-btn" id="cycle">
      <i class="fas fa-redo"></i> –¶–∏–∫–ª
    </button>
    <button class="btn donate-btn" id="donate">
      <i class="fas fa-gem"></i> TON
    </button>
    <button class="btn map-btn" id="mapBtn">
      <i class="fas fa-map-marked-alt"></i> –ö–∞—Ä—Ç–∞
    </button>
  </div>

  <div id="mapView">
    <div class="stat-card" style="background:rgba(0,30,30,0.4);margin-bottom:12px;">
      üèóÔ∏è –î–æ–º ‚Ññ<b id="buildingNum">1</b> (<b id="floorCount">0</b>/100)
    </div>
    <div class="building-container" id="buildingVisual"></div>
    <div style="margin:8px 0; font-size:0.95rem;">
      –ù–∞–∂–∞—Ç–∏–π: <b id="buildClicks">0</b> / 1000
    </div>
    <button class="btn build-btn" style="background:linear-gradient(135deg, #2ecc71, #1abc9c);color:#000;" id="buildBtn">
      <i class="fas fa-hammer"></i> –°—Ç—Ä–æ–∏—Ç—å
    </button>
    <div style="margin-top:10px; font-size:0.9rem; color:#aaffaa;" id="buildingStatus">
      –§—É–Ω–¥–∞–º–µ–Ω—Ç –∑–∞–ª–æ–∂–µ–Ω...
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    const tg = window.Telegram?.WebApp;
    if (tg) {
      tg.expand();
      tg.ready();
    }

    const WALLET_ADDRESS = "UQA5aUC-_Z0IK4_NqFJVdBKCGUzO9DXFwHMs7gwSMWGM8CxY";
    const CLICKS_PER_FLOOR = 1000;
    const MAX_FLOORS = 100;

    let game = JSON.parse(localStorage.getItem('pixelMiner_v7')) || {
      energy: 0,
      shards: 0,
      cycles: 0,
      tapPower: 1,
      buildClicks: 0,
      floors: 0,
      buildings: 1,
      userId: tg?.initDataUnsafe?.user?.id || Math.floor(Math.random() * 1e9)
    };

    const el = {
      energy: document.getElementById('energy'),
      shards: document.getElementById('shards'),
      cycles: document.getElementById('cycles'),
      mineBtn: document.getElementById('mineBtn'),
      upgrade: document.getElementById('upgrade'),
      cycle: document.getElementById('cycle'),
      donate: document.getElementById('donate'),
      mapBtn: document.getElementById('mapBtn'),
      mapView: document.getElementById('mapView'),
      buildBtn: document.getElementById('buildBtn'),
      buildClicks: document.getElementById('buildClicks'),
      buildingNum: document.getElementById('buildingNum'),
      floorCount: document.getElementById('floorCount'),
      buildingVisual: document.getElementById('buildingVisual'),
      buildingStatus: document.getElementById('buildingStatus'),
      toast: document.getElementById('toast')
    };

    function showToast(message) {
      el.toast.textContent = message;
      el.toast.style.display = 'block';
      setTimeout(() => { el.toast.style.display = 'none'; }, 2000);
    }

    function render() {
      el.energy.textContent = Math.floor(game.energy);
      el.shards.textContent = game.shards;
      el.cycles.textContent = game.cycles;
      el.buildingNum.textContent = game.buildings;
      el.floorCount.textContent = game.floors;
      el.buildClicks.textContent = game.buildClicks;

      el.buildingVisual.innerHTML = '';
      const floorsToShow = Math.min(game.floors, 10);
      for (let i = 0; i < floorsToShow; i++) {
        const floor = document.createElement('div');
        floor.className = 'floor';
        el.buildingVisual.appendChild(floor);
      }

      if (game.floors >= MAX_FLOORS) {
        el.buildingStatus.textContent = '‚úÖ –î–æ–º –∑–∞–≤–µ—Ä—à—ë–Ω! –ù–∞–∂–º–∏—Ç–µ "–°—Ç—Ä–æ–∏—Ç—å" –¥–ª—è –Ω–æ–≤–æ–≥–æ.';
      } else if (game.floors > 0) {
        el.buildingStatus.textContent = 'üèóÔ∏è –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –∏–¥—ë—Ç!';
      } else {
        el.buildingStatus.textContent = '–§—É–Ω–¥–∞–º–µ–Ω—Ç –∑–∞–ª–æ–∂–µ–Ω...';
      }
    }

    function save() {
      localStorage.setItem('pixelMiner_v7', JSON.stringify(game));
      render();
    }

    el.mineBtn.onclick = () => { game.energy += game.tapPower; save(); };
    el.upgrade.onclick = () => { if (game.energy >= 10) { game.energy -= 10; game.tapPower++; save(); } };
    el.cycle.onclick = () => {
      if (game.energy <= 0) return;
      const shards = Math.max(1, Math.floor(game.tapPower * 0.6));
      game.shards += shards;
      game.energy = 0;
      game.cycles++;
      alert(`‚úÖ –¶–∏–∫–ª –∑–∞–≤–µ—Ä—à—ë–Ω!\n+${shards} –æ—Å–∫–æ–ª–∫–æ–≤.`);
      save();
    };

    el.donate.onclick = () => {
      const comment = "PixelMiner_Support_" + game.userId;
      const url = `ton://transfer/${WALLET_ADDRESS}?amount=${0.1 * 1e9}&text=${encodeURIComponent(comment)}`;

      if (tg && typeof tg.openTelegramLink === 'function') {
        try {
          tg.openTelegramLink(url);
        } catch (e) {
          showToast("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –∫–æ—à–µ–ª—ë–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤ –º–æ–±–∏–ª—å–Ω–æ–º Telegram.");
        }
      } else {
        // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –æ—Ç–∫—Ä—ã—Ç—å –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ
        const newWindow = window.open(url, '_blank');
        if (!newWindow) {
          showToast("üîí –ë–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫ —Ä–µ–∫–ª–∞–º—ã –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –º–µ—à–∞—é—Ç –æ—Ç–∫—Ä—ã—Ç—å –∫–æ—à–µ–ª—ë–∫.");
        } else {
          showToast("üîó –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∫–æ—à–µ–ª—ë–∫ –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ...");
        }
      }
    };

    el.mapBtn.onclick = () => {
      el.mapView.style.display = el.mapView.style.display === 'none' ? 'block' : 'none';
    };

    el.buildBtn.onclick = () => {
      if (game.floors >= MAX_FLOORS) {
        game.buildings++;
        game.floors = 0;
        game.buildClicks = 0;
        showToast('üèóÔ∏è –ù–∞—á–∞—Ç–æ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –Ω–æ–≤–æ–≥–æ –∑–¥–∞–Ω–∏—è!');
      } else {
        game.buildClicks++;
        if (game.buildClicks >= CLICKS_PER_FLOOR) {
          game.floors++;
          game.buildClicks = 0;
          if (game.floors === MAX_FLOORS) {
            showToast('üèÜ –î–æ–º –∑–∞–≤–µ—Ä—à—ë–Ω! –ì–æ—Ä–¥–æ—Å—Ç—å —Ä–∞–π–æ–Ω–∞!');
          }
        }
      }
      save();
    };

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—à–∏—Ä—è–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    if (tg) {
      tg.expand();
    }

    render();
  </script>
</body>
</html>
