<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Pixel Miner</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: linear-gradient(135deg, #0f0c29, #3a1c71);
      color: white;
      font-family: 'Segoe UI', sans-serif;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding-top: 20px;
      overflow: hidden;
    }
    .container {
      text-align: center;
      width: 95%;
      max-width: 500px;
    }
    h1 {
      font-size: 1.8em;
      margin-bottom: 15px;
      color: #ffcc00;
      text-shadow: 0 0 10px rgba(255,204,0,0.5);
    }
    .stat {
      background: rgba(0,0,0,0.3);
      padding: 8px;
      margin: 6px 0;
      border-radius: 8px;
      font-size: 1.2em;
    }
    .btn {
      padding: 12px;
      margin: 8px 4px;
      border: none;
      border-radius: 10px;
      font-size: 1em;
      font-weight: bold;
      cursor: pointer;
      width: 95%;
      max-width: 280px;
      transition: transform 0.1s;
    }
    .btn:active { transform: scale(0.97); }
    #mineBtn {
      width: 130px;
      height: 130px;
      border-radius: 50%;
      background: radial-gradient(circle, #ff416c, #ff4b2b);
      color: white;
      font-size: 1.3em;
      border: 3px solid #ffcc00;
      box-shadow: 0 6px 20px rgba(255,65,108,0.6);
      margin: 15px 0;
    }
    .donate-btn {
      background: linear-gradient(135deg, #FFD700, #FFA500);
      color: #000;
    }
    .cycle-btn {
      background: linear-gradient(135deg, #00c9ff, #92fe9d);
      color: #000;
    }
    .upgrade-btn {
      background: linear-gradient(135deg, #8E2DE2, #4A00E0);
      color: white;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>‚ö° Pixel Miner</h1>
    <div class="stat">–≠–Ω–µ—Ä–≥–∏—è: <b id="energy">0</b></div>
    <div class="stat">–û—Å–∫–æ–ª–∫–æ–≤ –ê—Å–∫–µ–Ω–∑–∏–∏: <b id="shards">0</b></div>
    <div class="stat">–¶–∏–∫–ª–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ: <b id="cycles">0</b></div>
    <button id="mineBtn">–¢–ê–ü!</button>
    <br>
    <button class="btn upgrade-btn" id="upgrade">–£–ª—É—á—à–∏—Ç—å –¥–æ–±—ã—á—É (+1) ‚Äì 10 –≠–Ω.</button>
    <button class="btn cycle-btn" id="cycle">üîÑ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ü–∏–∫–ª –æ—á–∏—â–µ–Ω–∏—è</button>
    <button class="btn donate-btn" id="donate">üíé –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (TON)</button>
  </div>

  <script>
    // === Telegram WebApp Init ===
    const tg = window.Telegram?.WebApp;
    if (tg) {
      tg.expand();
      tg.ready();
    }

    // === –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã ===
    const WALLET_ADDRESS = "UQA5aUC-_Z0IK4_NqFJVdBKCGUzO9DXFwHMs7gwSMWGM8CxY";
    const DONATION_AMOUNT = 0.1; // TON (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –¥–æ–Ω–∞—Ç)

    // === –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö ===
    let game = JSON.parse(localStorage.getItem('pixelMiner_v2')) || {
      energy: 0,
      shards: 0,
      cycles: 0,
      tapPower: 1,
      lastCycle: 0
    };

    // === DOM —Å—Å—ã–ª–∫–∏ ===
    const el = {
      energy: document.getElementById('energy'),
      shards: document.getElementById('shards'),
      cycles: document.getElementById('cycles'),
      mineBtn: document.getElementById('mineBtn'),
      upgrade: document.getElementById('upgrade'),
      cycle: document.getElementById('cycle'),
      donate: document.getElementById('donate')
    };

    // === –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ ===
    function render() {
      el.energy.textContent = Math.floor(game.energy);
      el.shards.textContent = game.shards;
      el.cycles.textContent = game.cycles;
    }

    // === –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ===
    function save() {
      localStorage.setItem('pixelMiner_v2', JSON.stringify(game));
      render();
    }

    // === –î–æ–±—ã—á–∞ —ç–Ω–µ—Ä–≥–∏–∏ ===
    el.mineBtn.addEventListener('click', () => {
      game.energy += game.tapPower;
      save();
    });

    // === –£–ª—É—á—à–µ–Ω–∏–µ ===
    el.upgrade.addEventListener('click', () => {
      if (game.energy >= 10) {
        game.energy -= 10;
        game.tapPower += 1;
        save();
      }
    });

    // === –ó–∞–º–∫–Ω—É—Ç—ã–π —Ü–∏–∫–ª ===
    el.cycle.addEventListener('click', () => {
      if (game.energy <= 0) return;

      // –ù–∞–≥—Ä–∞–¥–∞ = –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –æ—Ç —Å–∏–ª—ã
      const shardsEarned = Math.max(1, Math.floor(game.tapPower * 0.6));
      game.shards += shardsEarned;
      game.energy = 0; // –ø–æ—á—Ç–∏ –≤—Å—ë —Ç–µ—Ä—è–µ—Ç—Å—è ‚Üí –∑–∞–º–∫–Ω—É—Ç—ã–π —Ü–∏–∫–ª
      game.cycles += 1;

      alert(`‚úÖ –¶–∏–∫–ª –∑–∞–≤–µ—Ä—à—ë–Ω!\n–ü–æ–ª—É—á–µ–Ω–æ: ${shardsEarned} –æ—Å–∫–æ–ª–∫–æ–≤ –ê—Å–∫–µ–Ω–∑–∏–∏.\n–¢–µ–ø–µ—Ä—å –Ω–∞—á–Ω–∏ –∑–∞–Ω–æ–≤–æ ‚Äî —Ç—ã —Å—Ç–∞–ª —Å–∏–ª—å–Ω–µ–µ!`);

      save();
    });

    // === –î–æ–Ω–∞—Ç —á–µ—Ä–µ–∑ TON –∫–æ—à–µ–ª—ë–∫ ===
    el.donate.addEventListener('click', () => {
      // –§–æ—Ä–º–∏—Ä—É–µ–º deep-link –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ TON
      const comment = "PixelMiner_Support_" + (tg?.initDataUnsafe?.user?.id || 'anon');
      const encodedComment = encodeURIComponent(comment);
      const tonUrl = `ton://transfer/${WALLET_ADDRESS}?amount=${DONATION_AMOUNT * 1e9}&text=${encodedComment}`;

      if (tg && typeof tg.openTelegramLink === 'function') {
        tg.openTelegramLink(tonUrl);
      } else {
        // –†–µ–∑–µ—Ä–≤: –æ—Ç–∫—Ä—ã—Ç—å –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ
        window.open(tonUrl, '_blank');
      }
    });

    // === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ===
    render();
  </script>
</body>
</html>
    // –£–ª—É—á—à–µ–Ω–∏–µ
    upgradeBtn.addEventListener('click', () => {
      if (saveData.energy >= 10) {
        saveData.energy -= 10;
        saveData.tapPower += 1;
        updateUI();
        saveGame();
      }
    });

    // –¶–∏–∫–ª –æ—á–∏—â–µ–Ω–∏—è (–∑–∞–º–∫–Ω—É—Ç—ã–π —Ü–∏–∫–ª)
    cycleBtn.addEventListener('click', () => {
      if (saveData.energy < 1) return;
      const shardsEarned = Math.max(1, Math.floor(saveData.tapPower / 2));
      saveData.shards += shardsEarned;
      saveData.energy = 0; // –ø–æ—á—Ç–∏ –≤—Å—ë —Ç–µ—Ä—è–µ—Ç—Å—è
      saveData.cycles += 1;
      alert(`–¶–∏–∫–ª –∑–∞–≤–µ—Ä—à—ë–Ω! –ü–æ–ª—É—á–µ–Ω–æ ${shardsEarned} –æ—Å–∫–æ–ª–∫–æ–≤.`);
      updateUI();
      saveGame();
    });

    // –î–æ–Ω–∞—Ç —á–µ—Ä–µ–∑ TON (Telegram Stars / TON Connect)
    donateBtn.addEventListener('click', () => {
      if (typeof tg.openInvoice === 'function') {
        // –ü—Ä–∏–º–µ—Ä: –µ—Å–ª–∏ –≤—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç–µ Stars –≤ BotFather
        tg.openInvoice('https://your-bot-payment-link.com'); // ‚Üê –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
      } else {
        alert('–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —á–µ—Ä–µ–∑ TON —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç! –°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏.');
        // –í –±—É–¥—É—â–µ–º: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å @wallet –∏–ª–∏ TON Connect
      }
    });

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    function saveGame() {
      localStorage.setItem('pixelMinerSave', JSON.stringify(saveData));
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    updateUI();
  </script>
</body>
</html>
